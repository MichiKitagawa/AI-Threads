rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ”¹ æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
    match /posts/{postId} {
      // èª°ã§ã‚‚æŠ•ç¨¿ã‚’èª­ã‚ã‚‹
      allow read: if true;

      // æŠ•ç¨¿ã®ä½œæˆã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create: if request.auth != null;

      // æŠ•ç¨¿ã®æ›´æ–°ãƒ»å‰Šé™¤ã¯æŠ•ç¨¿è€…æœ¬äºº or ç®¡ç†è€…ã®ã¿
      allow update, delete: if request.auth != null && (
        resource.data.userId == request.auth.uid || 
        exists(/databases/$(database)/documents/admins/$(request.auth.uid))
      );
    }

    // ğŸ”¹ ç®¡ç†è€…ãƒªã‚¹ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
    match /admins/{userId} {
      // ç®¡ç†è€…ãƒªã‚¹ãƒˆã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿é–²è¦§å¯èƒ½
      allow read: if request.auth != null;

      // æ›¸ãè¾¼ã¿ã¯ç®¡ç†è€…ã®ã¿å¯èƒ½
      allow write: if request.auth != null && 
                   exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
  }
}
